/** 
 * Kiubi API - variantes multi-critères
 * 
 * Copyright 2013 Troll d'idees
 */
(function(a){var l={},g={},m=function(d,e){var f=!1,b={};return a.each(d,function(c,d){var h={};h[c]=d;
var k=c.lastIndexOf(e);if(0<k){f=f||c.indexOf(e)<k;var p=c.substr(k+1);c=c.substr(0,k);h={};h[c]={};h[c
][p]=d}void 0!==b[c]?b=a.extend(true,b,h):b[c]=h[c]}),f?m(b,e):b},n=function(d,e,f,b){b=parseInt(b||0);
var c=a("<span>").addClass("criterion").data("depth",b).appendTo(e);a("<span>").html(f[b]).appendTo(c);
var g=a("<select>").appendTo(c);a.each(d,function(c,b){var e=a("<option>",{html:c});e.data("value",b);e
.appendTo(g)}); g.change(function(){var c = a(this).parent().data("depth"); a.each( a(".criterion", e),
function(){a(this).data("depth")>c&&a(this).remove()});var b=a("option:selected",this).data("value"),d=
a("input[name=vid]", e); d.length ||(d=a("<input>",{type:"hidden", name:"vid"}).appendTo(e));"object"==
typeof b?n(b, e, f, c+1):b?(a(".price",e.parent()).html(l[b].price_inc_vat_label), a(".ajout_panier",e.
parent()).show(),d.val(b)):(a(".price",e.parent()).empty(),a(".ajout_panier", e.parent()).hide(),d.val(
""))});g.change()}; a.fn.variantes_multicriteres=function(d){void 0===g[d.type]&&(g[d.type]=!1,a.ajax({
url:"/theme/fr/produits/"+d.type+"/config.xml",dataType:"xml",async:!1}).done(function(b){b=a("extra c\
ritere",b);b.length&&(g[d.type]=[], a.each(b,function(){g[d.type].push(a(this).text())}))}));var e=g[d.
type];if(!1===e)return this;var f={};return a.each(d.variants,function(a,c){if(!c.is_available) return;
f[c.name]=c.id;l[c.id]=c}),f=m(f, "|"),this.empty(),n(f, this, e),a('<div class="price">').insertAfter(
this),a("select:last",this).change(),this}})(jQuery);